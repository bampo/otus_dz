# Регистрация клиента

## Ключевые участники
- Пользователь
- Фронтенд (AuthService)
- API шлюз
- Сервис Клиента (AuthController)
- База данных
- Сервис Уведомлений

## Последовательность шагов
1. **Взаимодействие пользователя**
   - Пользователь открывает страницу регистрации на фронтенде.
   - Пользователь заполняет форму регистрации с именем, фамилией, электронной почтой и паролем.

2. **Обработка фронтенда**
   - AuthService в фронтенде получает данные формы.
   - Он отправляет POST-запрос к API шлюзу с данными регистрации.

3. **Маршрутизация API шлюза**
   - API шлюз перенаправляет запрос в Сервис Клиента's AuthController.

4. **Обработка Сервиса Клиента**
   - Сервис Клиента сохраняет новую запись клиента в базе данных.
   - Сервис Клиента публикует событие `CustomerRegistered`.

5. **Сервис Уведомлений**
   - Сервис Уведомлений получает событие `CustomerRegistered`.
   - Он отправляет приветственное письмо с ссылкой на подтверждение электронной почты новому зарегистрированному пользователю.

6. **Активация логина**
   - Пользователь переходит по ссылке в письме.
   - AuthService отправляет GET-запрос к API шлюзу с токеном верификации.
   - API шлюз перенаправляет запрос в Сервис Клиента.
   - Сервис Клиента активирует логин пользователя в базе данных.

7. **Ответ пользователю**
   - Сервис Клиента возвращает успешный ответ.
   - Фронтенд отображает сообщение подтверждения пользователю, указывая, что логин был успешно активирован.

## Диаграмма последовательности

```mermaid
sequenceDiagram
    participant User as Пользователь
    participant FE as Фронтенд (AuthService)
    participant API_GW as API шлюз
    participant CUST_SVC as Сервис Клиента (AuthController)
    participant DB as База данных
    participant NOTIF_SVC as Сервис Уведомлений

    User->>FE: Подает форму регистрации
    FE->>API_GW: POST /api/customers/auth/register с данными пользователя
    API_GW->>CUST_SVC: Перенаправляет запрос в Сервис Клиента
    CUST_SVC->>DB: Сохраняет новую запись клиента
    CUST_SVC->>NOTIF_SVC: Публикует событие CustomerRegistered
    NOTIF_SVC->>NOTIF_SVC: Отправляет приветственное письмо с ссылкой для верификации электронной почты
    User->>FE: Переходит по ссылке в письме
    FE->>API_GW: GET /api/customers/auth/verify-email с токеном верификации
    API_GW->>CUST_SVC: Перенаправляет запрос в Сервис Клиента
    CUST_SVC->>DB: Активирует логин пользователя
    CUST_SVC-->>API_GW: Возвращает успешный ответ
    API_GW-->>FE: Перенаправляет ответ в фронтенд
    FE-->>User: Отображает сообщение подтверждения активации логина
```

## Ключевые компоненты
- **Фронтенд**: Обрабатывает взаимодействие пользователя и отправляет данные регистрации на бэкэнд.
- **AuthService**: Управляет операциями аутентификации на фронтенде.
- **API шлюз**: Маршрутирует запросы между фронтендом и сервисами бэкэнда.
- **Сервис Клиента**: Обрабатывает регистрацию, сохраняет данные клиента в базе данных, публикует события и активирует логин пользователя.
- **Сервис Уведомлений**: Отправляет электронные письма на основе событий, опубликованных другими сервисами.
